

アプリはもうすでにあるものということが前提

初めに
無料レベルの Azure App Service プランを作成する
ローカル リポジトリからの Git デプロイ向けに構成された Azure App Service 内に、Web API を作成する
アプリ用にアカウント レベルのデプロイ資格情報を設定する
Git をローカルで構成する
Web API を App Service インスタンスにデプロイする

API Gateway 構築手順

VM上へのAPI gateway 構築手順

サンドボックスをアクティブ化したときと同じアカウントを使用して、Azure portal  にサインインします。

左側のメニューで、[+ リソースの作成] をクリックします。

[統合] をクリックしてから、[API 管理] をクリックします。

[API Management サービス] ページで、次の詳細を入力します。

フィールド	詳細
名前	apim-NorthWindShoes<random number>。名前がグローバルに一意であることを保証するために、乱数を使います。
サブスクリプション	コンシェルジェ サブスクリプション
リソース グループ	317bd307-3a32-44cc-86a3-69e30bf2012b という既存のリソース グループを選択します。
場所	次のいずれかから選択します。米国中北部、米国西部、西ヨーロッパ、北ヨーロッパ、東南アジア、オーストラリア東部。 この演習で使用する Consumption レベルは、これらのリージョンでのみ使用できます。
組織名	NorthWindShoes。 この名前を使って、開発者ポータルでリソースを識別します。
管理者のメール アドレス	このアドレスはシステム通知のために使われます。既定値は自分の Azure アカウントのメール アドレスです。
価格レベル	Consumption (preview)。⇒消費
 注意

注:従量課金プランを使うのは、テスト中にずっと高速に作成できるためです。 エクスペリエンス全体は他の価格レベルとよく似ています。

[作成] をクリックします。

デプロイには数分かかることがあります。 デプロイが完了すると、指定したメール アドレスにメッセージが届きます。 また、Azure リソースの一覧にゲートウェイが表示されます。

次のユニット: API をインポートおよび発行する

APIのインポート及び発行

インポートした API を介してデータが処理される方法を視覚化するための方法として、API ゲートウェイを使用できます。 データセットと対話し、API を通じてパラメーターを渡すことができます。
管理者の場合は、Azure portal で API を視覚化できます。
ポリシーにて受信および送信ヘッダーの設定



openapiのapiインポート方法
API をインポートする
この演習の最初の部分では、API Management ゲートウェイに Northwind Shoes をインポートします。

サンドボックスをアクティブ化したときと同じアカウントを使用して、Azure portal  にサインインします。

左側のメニューで、[すべてのリソース] をクリックしてから、使用する API ゲートウェイを選択します。

[API 管理] の下で [API] をクリックします。

[Add a new API](新しい API の追加) ページ上で [OpenAPI] をクリックします。

新しい API を追加する

[OpenAPI 仕様から作成する] ページ上の [OpenAPI の仕様] ボックス内に、最初の演習の最後に保存した swagger の JSON の URL を貼り付けます。

 注意

ボックスから移動すると、他のフィールドの一部が自動的に入力されることに気づくでしょう。 これは、必要な接続の詳細がすべて指定されている OpenAPI を使用したためです。

その他の設定は、既定値のままにしておきます。

[作成] をクリックします。


apiのテストまで行えるらしい
restだったらswaggerのurl設定で行ける？swagger json urlなるものを登録している

https://ShoeCoAPId081bfde57.azurewebsites.net/swagger/v1/swagger.json

↑作成したapiを登録するにはどうすればよい？
作っているapiはrestだろうけど、インポート方法が違う？


API を視覚化する

アプリのデプロイ後環境を見ているurlになっている

実際にGTのapiにつなぐとしたらどうすればよいか


gettokenでなくサブスクリプションを利用する手がある

HTTPリクエストへのサブスクリプション
既定のヘッダー名は Ocp-Apim-Subscription-Key で、既定のクエリ文字列は subscription-key にて設定可能

これをするにはユーザに紐づいたサブスクリプションキーを発行する必要がある


パートナーは、オンボード プロセスの一部として各自のキーを付与されます。 この演習では管理者キーを使いますが、一度キーを取得した後は、API 呼び出しでキーを使うプロセスは同じです。

サンドボックスをアクティブ化したときと同じアカウントを使用して、Azure portal  にサインインします。
左側のメニューで、[すべてのリソース] をクリックしてから、使用する API ゲートウェイをクリックします。
[API Management] の下で、[サブスクリプション] をクリックします。
[Built-in all-access subscription](組み込みの全アクセス サブスクリプション) のコンテキスト メニュー (...) をクリックしてから、[キーの表示/非表示] をクリックします。
[主キー] の [クリックしてコピー] ボタンをクリックします。
メモ帳などの場所に、このキーを保存します。


4df3be1a66d149f0869b4149706c8072

IP制御のアクセス制御画家の王


今回はカンファレンスAPIの仕様がOpenAPI（RESTful APIを記述するための標準フォーマット）形式で公開されているため、「OpenAPI specification」を選択します。
OpenAPI以外には、WADL（REST APIの定義書）やWSDL（SOAP APIの定義書）といったXMLベースで記述された定義書であったり、APIを公開することのできる他のAzureサービス（Logic App、API App、Function App）からAPIをインポートすることも可能です。


「API URL suffix」には「conference」と入力します。「API URL suffix」は、URLのパスに使用されるもので必須項目ではありませんが、入力しておくことで今後別のAPIを追加する際にパス名が衝突してしまうといったトラブルを回避するために指定することをおすすめします。



個々のサイトにやりたいことは書いてある
https://docs.microsoft.com/ja-jp/azure/api-management/api-management-howto-protect-backend-with-aad



kongを通さなくてもリクエストは可能
接続先情報を入れてあげる必要性

うちのswaggerfileを見てみて入れれそうならそのやり方で無理奈良部うのやり方

quita

https://qiita.com/VA_nakatsu/items/401c7c80942c37f781d9

